<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Attendance Monitor - Real-time Dashboard</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
          <i data-lucide="moon" id="themeIcon"></i>
        </button>
        <div class="header-left">
          <h1>
            <i data-lucide="clipboard-list"></i>
            Attendance Monitor
          </h1>
          <span id="connectionStatus" class="status-badge disconnected">
            <span class="status-dot"></span>
            <span>Disconnected</span>
          </span>
        </div>
        <div class="header-right">
          <a href="/admin" class="btn btn-secondary" style="text-decoration: none; margin-right: 12px;">
            <i data-lucide="settings"></i>
            Admin
          </a>
          <div class="device-status" id="deviceStatus">
            <i data-lucide="cpu"></i>
            Device: Not connected
          </div>
          <span class="live-indicator" id="liveIndicator">Live</span>
        </div>
      </div>

      <div
        class="test-form-container"
        id="testFormContainer"
        style="display: none"
      >
        <div class="test-form-header">
          <h2>
            <i data-lucide="flask-conical"></i>
            Virtual Test Form
          </h2>
          <div class="test-form-header-actions">
            <div class="quick-fill-buttons">
              <button type="button" class="btn-quick" id="fillStudentCheckIn">
                <i data-lucide="user-plus"></i>
                Student Check-in
              </button>
              <button type="button" class="btn-quick" id="fillStudentCheckOut">
                <i data-lucide="user-minus"></i>
                Student Check-out
              </button>
              <button type="button" class="btn-quick" id="fillStaffCheckIn">
                <i data-lucide="briefcase"></i>
                Staff Check-in
              </button>
              <button type="button" class="btn-quick" id="fillStaffCheckOut">
                <i data-lucide="briefcase"></i>
                Staff Check-out
              </button>
            </div>
            <button
              class="btn-collapse"
              id="toggleForm"
              aria-label="Toggle form"
            >
              <i data-lucide="chevron-up" id="collapseIcon"></i>
            </button>
          </div>
        </div>
        <div class="test-form-content" id="testFormContent">
          <div class="school-id-info">
            <i data-lucide="info"></i>
            <span
              >School ID: <strong id="schoolIdDisplay">Loading...</strong> (from
              .env)</span
            >
          </div>
          <div id="formAlert"></div>
          <form id="testAttendanceForm" class="test-form">
            <div class="form-group">
              <label for="testId">
                <i data-lucide="hash"></i>
                Record ID *
              </label>
              <input
                type="number"
                id="testId"
                name="id"
                required
                placeholder="e.g., 12345"
                min="1"
              />
            </div>
            <div class="form-group">
              <label for="testUserId">
                <i data-lucide="user"></i>
                User ID *
              </label>
              <input
                type="text"
                id="testUserId"
                name="user_id"
                required
                placeholder="e.g., STU001 or STAFF001"
              />
            </div>
            <div class="form-group">
              <label for="testTerminalSn">
                <i data-lucide="terminal"></i>
                Terminal Serial Number *
              </label>
              <input
                type="text"
                id="testTerminalSn"
                name="terminal_sn"
                required
                placeholder="e.g., TERM-12345"
              />
            </div>
            <div class="form-group">
              <label for="testUserName">
                <i data-lucide="user-circle"></i>
                User Name *
              </label>
              <input
                type="text"
                id="testUserName"
                name="user_name"
                required
                placeholder="e.g., John Doe"
              />
            </div>
            <div class="form-group">
              <label for="testAttTime">
                <i data-lucide="clock"></i>
                Attendance Time *
              </label>
              <input
                type="datetime-local"
                id="testAttTime"
                name="att_time"
                required
              />
            </div>
            <div class="form-group">
              <label for="testRecordType">
                <i data-lucide="file-text"></i>
                Record Type *
              </label>
              <select id="testRecordType" name="record_type" required>
                <option value="">Select type</option>
                <option value="Check-in">Check-in</option>
                <option value="Check-out">Check-out</option>
              </select>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" id="resetForm">
                <i data-lucide="rotate-ccw"></i>
                Reset
              </button>
              <button type="submit" class="btn btn-primary" id="submitForm">
                <i data-lucide="send"></i>
                Send Test Attendance
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="controls">
        <div class="search-box">
          <i data-lucide="search" class="search-icon"></i>
          <input
            type="text"
            id="searchInput"
            placeholder="Search by Student ID..."
          />
        </div>
        <div class="filter-buttons">
          <button class="filter-btn active" data-filter="all">
            <i data-lucide="list"></i>
            All
          </button>
          <button class="filter-btn" data-filter="today">
            <i data-lucide="calendar"></i>
            Today
          </button>
          <button class="filter-btn" data-filter="recent">
            <i data-lucide="clock"></i>
            Recent
          </button>
        </div>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-card-header">
            <h3>Total Records</h3>
            <div class="stat-icon">
              <i data-lucide="file-text"></i>
            </div>
          </div>
          <div class="value" id="totalRecords">0</div>
          <div class="sub-value">All time attendance</div>
        </div>
        <div class="stat-card">
          <div class="stat-card-header">
            <h3>Unique Students</h3>
            <div class="stat-icon">
              <i data-lucide="users"></i>
            </div>
          </div>
          <div class="value" id="uniqueStudents">0</div>
          <div class="sub-value">Registered students</div>
        </div>
        <div class="stat-card">
          <div class="stat-card-header">
            <h3>Today's Records</h3>
            <div class="stat-icon">
              <i data-lucide="calendar-days"></i>
            </div>
          </div>
          <div class="value" id="todayRecords">0</div>
          <div class="sub-value" id="todayDate"></div>
        </div>
        <div class="stat-card">
          <div class="stat-card-header">
            <h3>Last Update</h3>
            <div class="stat-icon">
              <i data-lucide="activity"></i>
            </div>
          </div>
          <div class="value" id="lastUpdate" style="font-size: 24px">
            --:--:--
          </div>
          <div class="sub-value">Real-time sync</div>
        </div>
      </div>

      <div class="data-container">
        <div id="dataList">
          <div class="empty-state">
            <i data-lucide="file-x" style="width: 64px; height: 64px"></i>
            <p>Waiting for attendance data...</p>
          </div>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
    <script>
      // Initialize Lucide icons on page load
      if (typeof lucide !== "undefined") {
        lucide.createIcons();
      }
    </script>
  </body>
</html>
